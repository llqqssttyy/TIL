# 2023-03-20 TIL : 리액트-스프링 서비스 배포하기

빌드 프로세스를 조사해보면서 알게된 것들을 기록한다. <br>
https://okky.kr/questions/1357368 를 참고

### 빌드하기!
일단 배포를 하려면 빌드 파일이 필요하다. 빌드 파일이란 빠른 실행을 위해 프로젝트를 압축시킨 파일이다. <br>
우선 우리 프로젝트는 CRA를 사용해서 만들었고, `frontend` 디렉토리 안에 `public`과 `src` 디렉토리가 존재했다.<br>
`npm run build`를 하면 같은 위치에 `build` 디렉토리가 생성되고 이곳에 빌드 파일이 저장된다.<br>
build 디렉토리의 index.html을 보면 코드가 공백 없이 한 줄로 압축되어 있는 것을 볼 수 있다.
<br><br>

### nginx?
우리가 빌드한 프론트와 스프링 프로젝트를 EC2 인스턴스에 올려야 하는데, 이때 nginx에 대한 설정을 해줘야 한다.<br> 
**nginx**란 웹 서버의 역할을 하는 소프트웨어다. 여기서 웹 서버란 정적 페이지를 처리하는 서버로, 파일 경로 이름을 받아 그 경로와 일치하는 contents를 반환하는 역할을 한다.<br>
웹 서버의 반대 개념으로는 WAS(Web Application Server)가 있는데 이는 동적인 contents(DB 조회, 트랜잭션 관리, 비즈니스 로직 수행)를 처리하는 역할을 한다.<br>
웹 서버를 WAS와 분리하는 이유는 각자 수행하는 역할이 다르기 때문이다. <br> 웹 페이지는 정적 컨텐츠와 동적 컨텐츠가 모두 존재하는데, 위 서버 중 어느 하나만 이용한다면 사용자가 원하는 요청에 대한 모든 결과값을 미리 만들어둬야 하거나, 요청을 통해 html을 받은 클라이언트가 다시 서버로 필요한 파일을 요청하고 받으면서 로딩하는 데 많은 시간이 들 것이다.<br><br>
말이 조금 샜지만, 결론적으로 nginx를 설치하면 클라이언트의 요청을 리액트 서버로 리다이렉트 해주거나, react의 서버에 대한 요청을 스프링 서버로 리다이렉트해주는 역할을 수행 해주면서 효율적인 프로세스가 가능해진다.
<br><br>

### 빌드 파일 올리기!
서버에 대한 설정을 마쳤으면 서버에 빌드 파일을 올리면 된다. <br>
인스턴스에 git을 설치하고 레포지터리를 clone 해주면 되는데, 우리는 프론트엔드와 백엔드가 같은 레포지터리를 사용하므로 main 외에 develop 브랜치와 release 브랜치만 생성해 개발은 develop 브랜치에서 하고, 빌드 파일은 release 브랜치에서 생성했다.<br>
이렇게 생성된 빌드파일까지 문제가 없으면 master 브랜치에서 pull을 해주면 된다.<br>

***
프로젝트를 서버에 올리고 나면 개발 -> 빌드 -> 배포를 매우 많이 반복하게 되는데 이번 경험으로 CI/CD 환경이 왜 필요한지 느끼게 됐다.. 이후에 인스턴스를 하나 더 만들어서 백업용 서버를 운영할 계획인데, 그곳에서는 CI/CD를 적용해봐야 할 것 같다.<br>
https://7942yongdae.tistory.com/136 나중에 참고할 링크